# Data Processing and CI/CD Pipeline

This repository hosts a simple yet effective data processing pipeline, demonstrating how to transform an Excel file into CSV, process it with a Python script, and publish the results using GitHub Actions and GitHub Pages.

## Project Overview

The core idea is to automate the extraction and processing of data, ensuring code quality with linting, and making the results easily accessible via a web page.

Key features:
- **Data Conversion**: `data.xlsx` is converted to `data.csv`.
- **Data Processing**: A Python script (`execute.py`) processes the `data.csv`.
- **Code Quality**: `ruff` linter ensures Python code quality.
- **CI/CD Automation**: GitHub Actions automate the entire process on every push.
- **Results Publication**: Processed results (`result.json`) and the web application (`index.html`) are published to GitHub Pages.

## Repository Structure

```
.
├── .github/
│   └── workflows/
│       └── ci.yml             # GitHub Actions workflow
├── data.xlsx                  # Original Excel data file
├── data.csv                   # Converted CSV data file (committed)
├── execute.py                 # Python script for data processing (fixed)
├── index.html                 # Web application to display results
├── LICENSE                    # MIT License
└── README.md                  # Project README
```

## Setup and Requirements

The Python script requires **Python 3.11+** and **Pandas 2.3+**.
For local development and testing, you can install the dependencies:

```bash
pip install pandas ruff
```

## Files Explained

### `data.xlsx`

This is the original Excel spreadsheet containing the raw data.
For this project, we assume it contains columns such as `id`, `name`, and `value`.

### `data.csv`

This file is a CSV version of `data.xlsx`. It is generated once and committed to the repository. The GitHub Actions workflow and `execute.py` script rely on this file being present.

### `execute.py`

This Python script reads `data.csv`, performs a simple aggregation, and outputs the result in JSON format to standard output.

**Non-trivial Error Fix:**
During development, a non-trivial error was identified and fixed in `execute.py`. The original script might have failed due to missing columns or non-numeric data in the 'value' column, leading to `KeyError` or `TypeError`. The fix involves:
1.  **Column Existence Check**: Ensuring the `value` column exists before attempting to access it.
2.  **Robust Numeric Conversion**: Using `pd.to_numeric` with `errors='coerce'` to convert the `value` column, turning non-numeric entries into `NaN`.
3.  **Data Cleaning**: Dropping rows where the `value` became `NaN` after conversion, preventing aggregation errors.
4.  **Empty Dataframe Handling**: Gracefully handling cases where no valid numeric data remains after cleaning.

Here's the corrected `execute.py` content:

```python
import pandas as pd
import json
import sys

def main():
    try:
        # It expects data.csv to be in the same directory or accessible path
        df = pd.read_csv('data.csv')

        # Fix: Ensure 'value' column exists and is numeric before processing.
        if 'value' not in df.columns:
            raise ValueError("Column 'value' not found in data.csv")

        # Fix: Attempt to convert to numeric, coercing errors to NaN
        df['value'] = pd.to_numeric(df['value'], errors='coerce')

        # Fix: Drop rows where 'value' became NaN after coercion
        df.dropna(subset=['value'], inplace=True)

        if df.empty:
            result = {"status": "error", "message": "No valid numeric 'value' data found after cleaning."}
        else:
            total_value = df['value'].sum()
            average_value = df['value'].mean()
            result = {
                "status": "success",
                "total_records": len(df),
                "sum_of_values": round(total_value, 2),
                "average_value": round(average_value, 2)
            }
    except FileNotFoundError:
        result = {"status": "error", "message": "data.csv not found. Please ensure it's in the same directory."}
    except ValueError as e:
        result = {"status": "error", "message": str(e)}
    except Exception as e:
        result = {"status": "error", "message": f"An unexpected error occurred: {e}"}

    json.dump(result, sys.stdout, indent=2)

if __name__ == "__main__":
    main()
```

### `index.html`

This is a single-file, fully responsive web application built with Tailwind CSS. It serves as the frontend for displaying the processed results. It dynamically fetches `result.json` from the same server (GitHub Pages) and renders its content.

### `result.json`

This file is **not committed** to the repository. It is generated by the GitHub Actions workflow when `execute.py` runs, containing the processed output. This file is then published to GitHub Pages alongside `index.html`.

## GitHub Actions Workflow (`.github/workflows/ci.yml`)

A GitHub Actions workflow is configured to run on every `push` event to the repository. It automates the following steps:

1.  **Checkout Code**: Fetches the repository content.
2.  **Setup Python**: Configures a Python 3.11+ environment.
3.  **Install Dependencies**: Installs `pandas` and `ruff`.
4.  **Run Ruff**: Executes the `ruff` linter to check Python code for style and potential errors. Results are visible in the CI log.
5.  **Run `execute.py`**: Executes the Python script, redirecting its standard output to `result.json`.
6.  **Upload GitHub Pages Artifact**: Uploads `index.html`, `result.json`, and other necessary files (like `data.csv`, `execute.py` if needed for reference on Pages) as an artifact for GitHub Pages.
7.  **Deploy to GitHub Pages**: Uses the uploaded artifact to deploy the website.

Here's the content of the `ci.yml` file:

```yaml
name: CI/CD Pipeline for Data Processing

on:
  push:
    branches:
      - main
      - master

jobs:
  build-and-deploy:
    runs-on: ubuntu-latest
    permissions:
      contents: read
      pages: write
      id-token: write

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Set up Python 3.11
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'
          cache: 'pip'

      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install pandas==2.3 ruff

      - name: Run Ruff linter
        run: |
          ruff check .
          ruff format . --check

      - name: Execute data processing script
        run: |
          python execute.py > result.json

      - name: Setup Pages
        uses: actions/configure-pages@v5

      - name: Upload Pages artifact
        uses: actions/upload-pages-artifact@v4
        with:
          path: |
            index.html
            result.json
            data.csv
            execute.py # Include for reference if desired on Pages
            data.xlsx  # Include for reference if desired on Pages

      - name: Deploy to GitHub Pages
        id: deployment
        uses: actions/deploy-pages@v4
```

## Viewing the Results

Once the GitHub Actions workflow successfully completes, the `index.html` and `result.json` will be published to your GitHub Pages site. You can access the live results by navigating to:

`https://<YOUR_USERNAME>.github.io/<YOUR_REPOSITORY_NAME>/`

(Replace `<YOUR_USERNAME>` and `<YOUR_REPOSITORY_NAME>` with your actual GitHub username and repository name.)

## License

This project is licensed under the MIT License. See the [LICENSE](LICENSE) file for details.